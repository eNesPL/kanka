(()=>{"use strict";function e(){$.each($(".delete-confirm"),(function(){$(this).click((function(e){var n=$(this).data("name"),a=$(this).data("delete-target"),i=$(this).data("target");$(i).find(".target-name").text(n),$(this).data("mirrored")?$("#delete-confirm-mirror").show():$("#delete-confirm-mirror").hide(),$(this).data("recoverable")?($(i).find(".permanent").hide(),$(i).find(".recoverable").show()):($(i).find(".recoverable").hide(),$(i).find(".permanent").show()),a&&$(".delete-confirm-submit").data("target",a)}))})),$.each($(".delete-confirm-submit"),(function(e){$(this).unbind("click"),$(this).click((function(e){var n=$(this).data("target");n?($("#"+n+" input[name=remove_mirrored]").val($("#delete-confirm-mirror-checkbox").is(":checked")?1:0),$("#"+n).submit()):$("#delete-confirm-form").submit()}))}))}var n,a,i,o,t,r,d,l,m,s,c,p;function h(){$(".map-legend-marker").click((function(e){e.preventDefault(),window.map.panTo(L.latLng($(this).data("lat"),$(this).data("lng"))),window[$(this).data("id")].openPopup()})),$("a.sidebar-toggle").click((function(){f()}))}function f(){setTimeout((function(){window.map.invalidateSize()}),500)}function u(){$("#marker-main-fields").show(),$("#marker-footer").show()}$(document).ready((function(){window.map.invalidateSize(),window.map.on("popupopen",(function(n){e()})),$('a[href="#marker-pin"]').click((function(e){$('input[name="shape_id"]').val(1),$("#map-marker-bg-colour").show(),u()})),$('a[href="#marker-label"]').click((function(e){$('input[name="shape_id"]').val(2),$("#map-marker-bg-colour").hide(),u()})),$('a[href="#marker-circle"]').click((function(e){$('input[name="shape_id"]').val(3),$("#map-marker-bg-colour").show(),u()})),$('a[href="#marker-poly"]').click((function(e){$('input[name="shape_id"]').val(5),$("#map-marker-bg-colour").show(),u()})),$('a[href="#presets"]').click((function(e){!function(e){if($("#marker-main-fields").hide(),$("#marker-footer").hide(),0===$(".marker-preset-list .fa-spinner").length)return;console.log("load from",e),$.ajax({url:e}).done((function(e){$(".marker-preset-list").html(e),$(".preset-use").on("click",(function(e){e.preventDefault();var n=$(this).data("url");$(this).find(".fa-spin").show(),$.ajax({url:n,context:this}).done((function(e){$(this).find(".fa-spin").hide(),Object.keys(e.preset).forEach((function(n){var a=e.preset[n],i=$('[name="'+n+'"]');0!==i.length?n.endsWith("colour")?i.spectrum("set",a):i.val(a):console.info("markerPreset","unknown field",n)})),$('a[href="#marker-pin"]').click()}))}))}))}($(this).data("presets"))})),$('a[href="#form-markers"]').click((function(e){window.map.invalidateSize()})),function(){if(0===(n=$("#map-body")).length)return;a=$("#sidebar-map"),i=$("#sidebar-marker"),o=$("#map-marker-modal"),r=$("#map-marker-modal-title"),t=$("#map-marker-modal-content"),window.markerDetails=function(d){!function(){if(window.kankaIsMobile.matches)return t.find(".spinner").show(),t.find(".content").hide(),void o.modal("toggle");n.removeClass("sidebar-collapse").addClass("sidebar-open"),a.hide(),i.html("").show(),i.parent().find(".spinner").show(),f()}(),window.kankaIsMobile.matches&&(d+="?mobile=1"),$.ajax({url:d,type:"GET",async:!0,success:function(o){o&&(window.kankaIsMobile.matches?(r.html(o.name),t.find(".content").html(o.body).show(),t.find(".spinner").hide()):(i.html(o.body).show().parent().find(".spinner").hide(),$(".marker-close").click((function(e){i.hide(),a.show()})),n.addClass("sidebar-open")),e())}})},h()}(),function(){$('select[name="size_id"]').change((function(e){6==this.value?($(".map-marker-circle-helper").hide(),$(".map-marker-circle-radius").show()):($(".map-marker-circle-radius").hide(),$(".map-marker-circle-helper").show())}));var e=$("#map-marker-form");if(0===$("#entity-form").length&&0===$(".map-marker-edit-form").length)return;e.unbind("submit").on("submit",(function(){window.entityFormHasUnsavedChanges=!1})),h()}(),$(".map-marker-entry-click").click((function(e){e.preventDefault(),$(this).parent().hide(),$(".map-marker-entry-entry").show()})),$("#start-drawing-polygon").on("click",(function(e){e.preventDefault(),window.drawingPolygon=!0,window.showToast($(this).data("toast")),$("body").addClass("map-drawing-mode"),$("#marker-modal").modal("hide")})),(d=$("#reset-polygon")).click((function(e){e.preventDefault(),window.polygon&&window.map.removeLayer(window.polygon),$('textarea[name="custom_shape"]').val(""),d.hide()})),$(".btn-mode-enable").click((function(e){e.preventDefault(),window.exploreEditMode=!0,$("body").addClass("map-edit-mode")})),$(".btn-mode-disable").click((function(e){e.preventDefault(),window.exploreEditMode=!1,$("body").removeClass("map-edit-mode")})),$(".btn-mode-drawing").click((function(e){e.preventDefault(),window.drawingPolygon=!1,$("body").removeClass("map-drawing-mode"),$("#marker-modal").modal("show")}))})),window.addPolygonPosition=function(e,n){var a=$('textarea[name="custom_shape"]'),i=a.val();i.length>0&&(i+=" "),a.val(i+e+","+n);var o=a.val().trim(" ").split(" "),t=[];o.forEach((function(e){var n=e.split(",");t.push([n[0],n[1]])}),t),window.polygon&&window.map.removeLayer(window.polygon),function(){(!(m=$('input[name="polygon_style[stroke]"]').val())||m.length<7)&&(m="red");s=$('input[name="polygon_style[stroke-opacity]"]').val(),isNaN(s)||!s?s=1:s/=100;(!(c=$('input[name="colour"]').val())||c.length<7)&&(c="red");p=$('input[name="opacity"]').val(),isNaN(p)?p=.5:p/=100;l=$('input[name="polygon_style[stroke-width]"]').val(),(isNaN(l)||!l)&&(l=1)}(),window.polygon=L.polygon(t,{weight:l,color:m,opacity:s,fillColor:c,fillOpacity:p,linecap:"round",linejoin:"round"}),window.polygon.addTo(window.map),d.show()}})();
//# sourceMappingURL=map-v3.js.map