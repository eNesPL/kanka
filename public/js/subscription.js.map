{"version":3,"file":"/js/subscription.js","mappings":"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","sources":["webpack:///./resources/assets/js/subscription.js"],"sourcesContent":["// Strip variables for the page\nvar stripe, elements, card;\n\n// Form status\nvar formSubmit = false;\nvar formSubmitBtn;\n\n// Coupon stuff\nvar couponBtn, couponField, couponSuccess, couponError, couponId;\n\nvar subscribeModal;\n\n$(document).ready(function() {\n    initStripe();\n    initPeriodToggle();\n    subscribeModal = $('#subscribe-confirm');\n    subscribeModal.on('shown.bs.modal', () => {\n        initConfirmListener();\n    });\n});\n\n// Initialize the stripe API\nfunction initStripe() {\n    let token = $('#stripe-token');\n    stripe = Stripe(token.val());\n\n    // Create an instance of Elements.\n    elements = stripe.elements();\n}\n\n// When the modal is opened and loaded, inject stripe if needed and the form validator\nfunction initConfirmListener()\n{\n    formSubmitBtn = $('.subscription-confirm-button');\n\n    let cardSelector = $('#card-element');\n    if (cardSelector.length === 1) {\n        // First time opening the modal, initiate a new card\n        if (!card) {\n            // Custom styling can be passed to options when creating an Element.\n            // (Note that this demo uses a wider set of styles than the guide below.)\n            let style = {\n                base: {\n                    color: '#555555',\n                    fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n                    fontSmoothing: 'antialiased',\n                    fontSize: '14px',\n                    '::placeholder': {\n                        color: '#777777'\n                    }\n                },\n                invalid: {\n                    color: '#fa755a',\n                    iconColor: '#fa755a'\n                }\n            };\n\n            // Create an instance of the card Element.\n            card = elements.create('card', {hidePostalCode: true, style: style});\n        }\n\n        // Add an instance of the card Element into the `card-element` <div>.\n        card.mount('#card-element');\n    }\n\n    $('#subscription-confirm').submit(function (e) {\n        // If we've passed the strip validation, we can go further\n        if (formSubmit) {\n            return true;\n        }\n\n        e.preventDefault();\n        formSubmitBtn.addClass('disabled');\n        formSubmitBtn.find('span').hide();\n        formSubmitBtn.find('.spinner').show();\n\n        let intentToken = $('input[name=\"subscription-intent-token\"]');\n        let errorMessage = $('.alert-danger');\n        errorMessage.hide();\n\n        // If the form already has a payment id, we don't need stripe to add the new one\n        let cardID = $('input[name=\"payment_id\"]');\n        if (cardID.val()) {\n            formSubmit = true;\n            $('#subscription-confirm').submit();\n            return false;\n        }\n\n        stripe.confirmCardSetup(\n            intentToken.val(), {\n                payment_method: {\n                    card: card,\n                    billing_details: {\n                        name: $('input[name=\"card-holder-name\"]').val()\n                    }\n                }\n            }\n        ).then(function (result) {\n            if (result.error) {\n                formSubmitBtn.removeClass('disabled').text(formSubmitBtn.data('text'));\n                errorMessage.text(result.error.message).show();\n                return false;\n            } else {\n                cardID.val(result.setupIntent.payment_method);\n                formSubmit = true;\n                $('#subscription-confirm').submit();\n\n            }\n        }.bind(this));\n    });\n\n    $('.subscription-form').submit(function () {\n        formSubmitBtn.addClass('disabled')\n            .find('span').hide()\n            .parent().find('.spinner').show();\n\n        return true;\n    });\n\n    couponBtn = $('#coupon-check-btn');\n    couponField = $('#coupon-check');\n    couponSuccess = $('#coupon-success');\n    couponError = $('#coupon-invalid');\n    couponId = $('#coupon');\n\n    couponBtn.click(function () {\n        checkCoupon();\n    });\n    couponField.change(function() {\n        checkCoupon();\n    });\n    couponField.focus(function () {\n        formSubmitBtn.addClass('disabled').prop('disabled', true);\n    });\n    couponField.focusout(function () {\n        let coupon = couponField.val();\n        if (!coupon) {\n            formSubmitBtn.removeClass('disabled').prop('disabled', false);\n        }\n    });\n}\n\nfunction checkCoupon() {\n    let coupon = couponField.val();\n    let url = couponField.data('url');\n\n    couponBtn.prop('disabled', true)\n        .find('.check').hide()\n        .parent().find('.spinner').show();\n\n    if (!coupon) {\n        formSubmitBtn.removeClass('disabled').prop('disabled', false);\n    }\n\n    $.ajax({\n        url: url + '?coupon=' + coupon,\n        context: this\n    }).done(function (result) {\n        couponBtn\n            .prop('disabled', false)\n            .find('.check').show()\n            .parent().find('.spinner').hide();\n\n        formSubmitBtn.removeClass('disabled').prop('disabled', false);\n\n        if (!result.valid) {\n            couponSuccess.hide();\n            couponError.html(result.error).show();\n            couponId.val('');\n            subscribeModal.removeClass('valid-coupon');\n\n            return;\n        }\n\n        couponError.hide();\n        couponSuccess.html(result.discount).show();\n        couponId.val(result.coupon);\n        subscribeModal.addClass('valid-coupon');\n    }).fail(function (result) {\n        couponBtn\n            .prop('disabled', false)\n            .find('.check').show()\n            .parent().find('.spinner').hide();\n\n        if (result.responseJSON) {\n            couponError.html(result.responseJSON.message).show();\n        }\n    });\n}\n\nfunction initPeriodToggle() {\n    $('input[name=\"period\"]').change(function () {\n        let box = $('#pricing-overview');\n        console.log('checked?', this.checked);\n        if (this.checked) {\n            box.removeClass('period-month').addClass('period-year');\n        } else {\n            box.removeClass('period-year').addClass('period-month');\n        }\n    });\n}\n"],"names":["stripe","elements","card","formSubmitBtn","couponBtn","couponField","couponSuccess","couponError","couponId","subscribeModal","formSubmit","checkCoupon","coupon","val","url","data","prop","find","hide","parent","show","removeClass","$","ajax","context","this","done","result","valid","html","error","discount","addClass","fail","responseJSON","message","document","ready","token","Stripe","change","box","console","log","checked","on","length","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","create","hidePostalCode","mount","submit","e","preventDefault","intentToken","errorMessage","cardID","confirmCardSetup","payment_method","billing_details","name","then","text","setupIntent","bind","click","focus","focusout","initConfirmListener"],"sourceRoot":""}